title: 从接口调用安全考虑
author: Peng Fang
tags:
  - 接口设计
categories:
  - 系统设计
date: 2018-05-17 18:09:00
---
在数据通信时，需要考虑接口访问的合法性和安全性：
 * 用户身份的合法性校验
 * 接口调用的合法性校验
 * 敏感数据加密

### 用户身份的合法性校验
用户身份校验一般通过用户名和密码。这里要考虑明文如何加密为密文。具体应用中RSA加密比较常见。RSA的密钥n长度一般是1024位，长度越长就越难被破解，目前被破解最长的RSA密钥是768位。
1. n能分解为两个质数的乘积，即n = p * q,这样我们就可以计算出欧拉函数φ(n) = (p-1)*(q-1)
2. 随机选择一个整数e，条件是1< e < φ(n)且与φ(n)互为质数
3. 计算[模反元素](http://zh.wikipedia.org/wiki/%E6%A8%A1%E5%8F%8D%E5%85%83%E7%B4%A0)d，使得ed被φ(n)除的余数为1。如果n能被因数分解，那么d可以被算出，意味着私钥被破解。
加密的公钥是(n,e)，解密的私钥是(n,d)
  用户合法性认证以后，在整个会话过程中，必须携带服务端返回的令牌token，以保证会话的合法性。

### 接口调用的合法性校验
为了防止接口调用中，参数被篡改或者防止重放攻击，需要在参数中加上签名。
在参数中可以加上imei(设备唯一Id)、timestamp，以确保签名sign的唯一性。sign=md5(path?query&imei&tamp&SIGN_KEY)
服务端接收到请求后，首先根据参数和SIGN_KEY验证签名结果是否一致，然后验证时间戳是否是在一定时间范围内，比如5分钟之内，如果超过则视为无效请求，如果在时间范围内，需要检查签名是否存在Redis中以防止重放攻击，如果不存在则存入Redis中5分钟。因为签名的唯一性，如果Redis中已存在相同的签名，那么很可能是重放攻击。

### 敏感数据加密
HTTP协议通信是不安全的，敏感数据传输采用基于SSL的HTTPS会更安全。
另外敏感数据最好加密（加盐）传输，防止被篡改。

#### 参考
[如何确保服务端的接口调用安全](https://segmentfault.com/q/1010000008918918)